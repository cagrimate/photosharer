name: Twitter Botu Ã‡alÄ±ÅŸtÄ±r

on:
  schedule:
    # 90 dakika aralÄ±klarla Ã§alÄ±ÅŸtÄ±r (UTC). Saat baÅŸÄ±ndan 5 dk sonra baÅŸlat.
    # 00:05, 03:05, 06:05, 09:05, 12:05, 15:05, 18:05, 21:05 (UTC)
    - cron: "5 0,3,6,9,12,15,18,21 * * *"
    # 01:35, 04:35, 07:35, 10:35, 13:35, 16:35, 19:35, 22:35 (UTC)
    - cron: "35 1,4,7,10,13,16,19,22 * * *"
  workflow_dispatch:

# GITHUB_TOKEN ile push atabilmek iÃ§in iÃ§erik izni
permissions:
  contents: write

jobs:
  run-bot:
    runs-on: ubuntu-latest
    # AynÄ± anda iki run Ã§akÄ±ÅŸmasÄ±n diye
    concurrency:
      group: twitter-bot
      cancel-in-progress: false

    steps:
      - name: Kodu Ã§ek
        uses: actions/checkout@v4
        with:
          persist-credentials: true   # push iÃ§in Ã¶nemli
          fetch-depth: 0              # tam history (bazÄ± durumlar iÃ§in iyi)

      - name: Python kur
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: BaÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kle
        run: |
          python -m pip install --upgrade pip
          pip install requests tweepy python-dotenv google-genai schedule

      - name: Botu tek sefer Ã§alÄ±ÅŸtÄ±r
        env:
          PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          CONSUMER_KEY: ${{ secrets.CONSUMER_KEY }}
          CONSUMER_SECRET: ${{ secrets.CONSUMER_SECRET }}
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          ACCESS_TOKEN_SECRET: ${{ secrets.ACCESS_TOKEN_SECRET }}
        run: |
          python pexels_otomasyon.py once

      - name: paylasilan_idler.txt deÄŸiÅŸtiyse commit et
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # paylasilan_idler.txt deÄŸiÅŸmiÅŸ mi kontrol et
          if ! git diff --quiet -- paylasilan_idler.txt; then
            echo "ğŸ”„ ID dosyasÄ± gÃ¼ncellenmiÅŸ, commit ediliyor..."
            git add paylasilan_idler.txt
            git commit -m "Update shared Pexels IDs [skip ci]" || echo "Commit gerekmedi"
            git push
          else
            echo "â„¹ï¸ ID dosyasÄ±nda deÄŸiÅŸiklik yok, commit yok."
          fi
